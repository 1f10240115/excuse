<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>èª ã«é…ã‚Œã¾ã—ãŸã€‚</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding-top: 72px; 
      }

      .container {
        max-width: 1200px;
        margin: 0 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        opacity: 0.9;
        width: 100%;
        height: 64px;
        text-align: center;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;

        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;

      }

      .header h1 {
        font-size: 1.6em;
        margin-bottom: 3px;
      }

      .header p {
        font-size: 1em;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .form-section {
        background: #f8f9fa;
        border-radius: 10px;
        margin-bottom: 30px;
      }

      .form-section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: black;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .excuses-section {
        margin-top: 30px;
      }

      .excuses-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .excuse-card {
        background: white;
        border: 1px solid #e1e5e9;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .excuse-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
      }

      .excuse-title {
        font-size: 1.2em;
        font-weight: 600;
        color: #333;
        margin-bottom: 10px;
      }

      .excuse-description {
        color: #666;
        margin-bottom: 15px;
        line-height: 1.5;
      }

      .excuse-category {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 500;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      /* Slideshow styles */
      .slideshow-container {
        max-width: 640px;
        margin: 24px auto;
        position: relative;
        overflow: hidden;
      }

      .slideshow-wrapper {
        display: flex;
        transition: transform 0.166s ease-in-out; /* é…ã‹ã£ãŸã®ã§ç´„3å€é€Ÿã«ã—ã¦ã¿ã¾ã—ãŸ */
        width: 300%;
      }

      .slide {
        width: 33.333%;
        flex-shrink: 0;
        padding: 0px;
      }

      .slide-title {
        font-weight: 600;
        margin-bottom: 6px;
        font-size: 1.1em;
        color: #333;
      }

      .slide-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .slide-btn {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 999px;
        background: #f7f7f7;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .slide-btn:hover {
        background: #e6f0ff;
        border-color: #7da7ff;
        transform: translateY(-1px);
      }

      .slide-btn.sel {
        background: #e6f0ff;
        border-color: #7da7ff;
        color: #2c5aa0;
        font-weight: 600;
      }

    .progress-indicator {
        display: flex;
        justify-content: center;
        align-items: center; /* ä¸­å¿ƒæƒãˆ */
        margin: 20px 0;
        gap: 8px;
    }


      .progress-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #ddd;
        transition: background 0.3s ease;
      }

      .progress-dot.active {
        background: #667eea;
      }

      .result-section {
        margin-top: 30px;
        text-align: center;
      }

      .result-title {
        font-weight: 600;
        margin-bottom: 6px;
        color: #333;
      }

      .result-content {
        border: 1px solid #ddd;
        border-radius: 12px;
        padding: 14px;
        line-height: 1.7;
        user-select: text;
        cursor: pointer;
        background: #f9f9f9;
        transition: all 0.3s ease;
      }

      .result-content:hover {
        background: #f0f0f0;
        border-color: #667eea;
      }

      .toast {
        position: fixed;
        left: 50%;
        bottom: 24px;
        transform: translateX(-50%);
        background: #333;
        color: #fff;
        padding: 8px 12px;
        border-radius: 999px;
        opacity: 0;
        transition: opacity 0.2s;
        pointer-events: none;
        z-index: 1000;
      }
      

      /* çŸ¢å°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
        .nav-arrow {
        background: #d0d5ff; /* æœ‰åŠ¹æ™‚ã®ãƒ™ãƒ¼ã‚¹ï¼šã‚„ã‚„æ¿ƒã„ã‚ */
        border: none;
        border-radius: 50%;
        width: 26px;
        height: 26px;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin: 0 4px;
        transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
        color: #3f51b5; /* æœ‰åŠ¹æ™‚ã®çŸ¢å°è‰²ã‚’æ¿ƒã */
    }

    .nav-arrow:hover:not(.disabled) {
        background: #b0b8ff; /* ã•ã‚‰ã«æ¿ƒãã—ã¦æŠ¼ã›ã‚‹æ„Ÿã˜ */
        box-shadow: 0 2px 6px rgba(63,81,181,0.35);
        transform: translateY(-1px);
    }

    .nav-arrow.disabled {
        opacity: 0.4;
        cursor: default;
        color: #aaa;
        background: #f0f4ff; /* ç„¡åŠ¹æ™‚ã¯è–„ã */
    }


      
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ™‡èª ã«é…ã‚Œã¾ã—ãŸğŸ™‡â€â™€ï¸</h1>
      </div>

      <div class="content">
        <!-- æ–°è¦ä½œæˆãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="form-section">
          <h2>ğŸ“ æ–°ã—ã„è¨€ã„è¨³ã‚’ä½œæˆ</h2>
          <!-- Result section -->
          <div class="result-section" style="text-align: left;">
            <div class="result-title">å‡ºåŠ›ï¼ˆã‚¿ãƒƒãƒ—ã§ã‚³ãƒ”ãƒ¼ï¼‰</div>
            <div class="result-content" id="result"></div>
          </div>
        </div>

          <!-- Slideshow section -->
          <section class="slideshow-container">
            <div class="slideshow-wrapper" id="slideshowWrapper">
              <!-- Slide 1: ç›¸æ‰‹ -->
              <div class="slide" style="text-align: left;">
                <div class="slide-title">ç›¸æ‰‹</div>
                <div class="slide-buttons" id="grp-to">
                    <button class="slide-btn sel" data-to="">æœªé¸æŠ</button>
                    <button class="slide-btn" data-to="ä¸Šå¸">ä¸Šå¸</button>
                    <button class="slide-btn" data-to="åŒåƒš">åŒåƒš</button>
                    <button class="slide-btn" data-to="å‹é”">å‹é”</button>
                    <button class="slide-btn" data-to="å…ˆè¼©">å…ˆè¼©</button>
                    <button class="slide-btn" data-to="å®¶æ—">å®¶æ—</button>
                    <button class="slide-btn" data-to="å…ˆç”Ÿ(æ•™æˆ)">å…ˆç”Ÿ(æ•™æˆ)</button>
                    <button class="slide-btn" data-to="ãƒã‚¤ãƒˆå…ˆ">ãƒã‚¤ãƒˆå…ˆ</button>
                </div>
              </div>

              <!-- Slide 2: åŸå›  -->
              <div class="slide">
                <div class="slide-title">åŸå› </div>
                <div class="slide-buttons" id="grp-cause">
                  <button class="slide-btn sel" data-cause="">æœªé¸æŠ</button>
                  <button class="slide-btn" data-cause="å¯åŠ">å¯åŠ</button>
                  <button class="slide-btn" data-cause="äºˆå®šãŒé•·å¼•ã„ãŸ">
                    äºˆå®šãŒé•·å¼•ã„ãŸ
                  </button>
                  <button class="slide-btn" data-cause="é›»è»Šé…å»¶">
                    é›»è»Šã®é…å»¶
                  </button>
                  <button class="slide-btn" data-cause="ãƒã‚¹é…å»¶">
                    ãƒã‚¹ã®é…å»¶
                  </button>
                  <button class="slide-btn" data-cause="ä½“èª¿ä¸è‰¯">
                    ä½“èª¿ä¸è‰¯
                  </button>
                  
                </div>
              </div>

              <!-- Slide 3: åˆ°ç€ã¾ã§ -->
              <div class="slide">
                <div class="slide-title">åˆ°ç€ã¾ã§</div>
                <div class="slide-buttons" id="grp-min">
                  <button class="slide-btn sel" data-min="">æœªé¸æŠ</button>
                  <button class="slide-btn" data-min="3">3åˆ†</button>
                  <button class="slide-btn" data-min="5">5åˆ†</button>
                  <button class="slide-btn" data-min="10">10åˆ†</button>
                  <button class="slide-btn" data-min="15">15åˆ†</button>
                  <button class="slide-btn" data-min="30">30åˆ†</button>
                  <button class="slide-btn" data-min="60">60åˆ†</button>
                </div>
              </div>
            </div>

            <!-- Progress indicator -->
            <div class="progress-indicator">
                <button class="nav-arrow" id="prevBtn" aria-label="å‰ã®ã‚¹ãƒ©ã‚¤ãƒ‰">â†</button>
                <div class="progress-dot active" data-slide="0"></div>
                <div class="progress-dot" data-slide="1"></div>
                <div class="progress-dot" data-slide="2"></div>
                <button class="nav-arrow" id="nextBtn" aria-label="æ¬¡ã®ã‚¹ãƒ©ã‚¤ãƒ‰">â†’</button>
            </div>




          <form id="excuseForm">
            <div class="form-group">
              <label for="detailedDescription">è©³ç´°ãªçŠ¶æ³èª¬æ˜</label>
              <textarea
                id="detailedDescription"
                name="detailedDescription"
                rows="4"
                placeholder="è©³ç´°ãªçŠ¶æ³ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
              ></textarea>
            </div>
            <button type="submit" class="btn">ä½œæˆ</button>
          </form>
        </section>

        <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="messageArea"></div>

            <!-- è¨€ã„è¨³ä¸€è¦§ -->
            <div class="excuses-section">
                <h2>ğŸ“‹ è¨€ã„è¨³ä¸€è¦§</h2>
                <div id="excusesContainer">
                    <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
                </div>
            </div>


            
<script>
/** ====== ãƒ¬ãƒ™ãƒ«3: AIç”Ÿæˆ fetch é…ç·šï¼ˆDOMã‹ã‚‰ç¾çŠ¶ã‚’èª­ã‚€ç‰ˆï¼‰ ====== **/
  const BACKEND_BASE = "http://localhost:8001"; // FastAPI ã®ãƒãƒ¼ãƒˆã«åˆã‚ã›ã‚‹

  document.getElementById("excuseForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    // ã„ã¾é¸ã°ã‚Œã¦ã„ã‚‹ UI çŠ¶æ…‹ã‚’ DOM ã‹ã‚‰å–å¾—ï¼ˆinitSlideshow ã¨åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    const minutes = document.querySelector('#grp-min .sel')?.dataset.min ?? "";
    const cause   = document.querySelector('#grp-cause .sel')?.dataset.cause ?? "";
    const target  = document.querySelector('#grp-to .sel')?.dataset.to ?? "";
    const detail  = document.getElementById("detailedDescription")?.value ?? "";

    // ç”Ÿæˆä¸­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰
    showMessage("AIãŒæ–‡ç« ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™â€¦", "success");

    try {
      const res = await fetch(`${BACKEND_BASE}/generate_excuse`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ minutes, cause, target, detail })
      });

      if (res.status === 503) {
        // æ··é›‘æ™‚ã¯ãƒ†ãƒ³ãƒ—ãƒ¬ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        const text = (typeof getPreparedExcuse === "function")
          ? getPreparedExcuse(minutes, cause, target) + "ï¼ˆAIæ··é›‘ã®ãŸã‚ãƒ†ãƒ³ãƒ—ãƒ¬è¡¨ç¤ºï¼‰"
          : "ç¾åœ¨AIãŒæ··é›‘ã—ã¦ã„ã¾ã™ã€‚æ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚";
        document.getElementById("result").textContent = text;
        return;
      }

      if (!res.ok) {
        const err = await res.json().catch(()=>({detail:res.statusText}));
        throw new Error(err.detail || `HTTP ${res.status}`);
      }

      const data = await res.json();
      document.getElementById("result").textContent = data.excuse || "ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
    } catch (error) {
      showMessage("AIç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message, "error");
    }
  });
</script>





















            
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ</div>

    <script>
      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¨€ã„è¨³ä¸€è¦§ã‚’å–å¾—
      document.addEventListener("DOMContentLoaded", function () {
        loadExcuses();
      });

      // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
      document
        .getElementById("excuseForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          createExcuse();
        });

      // è¨€ã„è¨³ä¸€è¦§ã‚’å–å¾—
      async function loadExcuses() {
        try {
          const response = await fetch("/api/excuses/");
          const excuses = await response.json();
          displayExcuses(excuses);
        } catch (error) {
          showMessage("è¨€ã„è¨³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message, "error");
        }
      }

      // è¨€ã„è¨³ä¸€è¦§ã‚’è¡¨ç¤º
      function displayExcuses(excuses) {
        const container = document.getElementById("excusesContainer");

        if (excuses.length === 0) {
          container.innerHTML = '<div class="loading">è¨€ã„è¨³ãŒã‚ã‚Šã¾ã›ã‚“</div>';
          return;
        }

            // å‰Šé™¤ã‰
            // const excusesHtml = excuses.map(excuse => `
            //     <div class="excuse-card">
            //         <div class="excuse-title">${excuse.title}</div>
            //         <div class="excuse-description">${excuse.description}</div>
            //         <span class="excuse-category">${excuse.category}</span>
            //     </div>
            // `).join('');
            const excusesHtml = excuses.map(excuse => `
                <div class="excuse-card">
                    <div class="excuse-description">${excuse.description}</div>
                </div>
            `
          )
          .join("");


        container.innerHTML = excusesHtml;
      }

      // æ–°ã—ã„è¨€ã„è¨³ã‚’ä½œæˆ
      async function createExcuse() {
        const formData = new FormData(document.getElementById("excuseForm"));
        const data = {
          detailedDescription: formData.get("detailedDescription"),
        };

            const response = await fetch('/api/excuses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
        try {
          const response = await fetch("/api/excuses/create/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            showMessage("è¨€ã„è¨³ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¾ã—ãŸï¼", "success");
            document.getElementById("excuseForm").reset();
            loadExcuses(); // ä¸€è¦§ã‚’æ›´æ–°
          } else {
            const error = await response.json();
            showMessage("ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.error, "error");
          }
        } catch (error) {
          showMessage("ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message, "error");
        }
      }

      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      function showMessage(message, type) {
        const messageArea = document.getElementById("messageArea");
        const messageDiv = document.createElement("div");
        messageDiv.className = type;
        messageDiv.textContent = message;

        messageArea.innerHTML = "";
        messageArea.appendChild(messageDiv);

        // 3ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        setTimeout(() => {
          messageDiv.remove();
        }, 3000);
      }
    </script>






    <!-- Slideshow functionality -->
    <script>
      const TIMES = ["", "3", "5", "10", "15", "30", "60"];
      const CAUSES = [
        "",
        "å¯åŠ",
        "äºˆå®šãŒé•·å¼•ã„ãŸ",
        "é›»è»Šé…å»¶",
        "ãƒã‚¹é…å»¶",
        "ä½“èª¿ä¸è‰¯",
      ];
      const TOS = ["", "ä¸Šå¸", "åŒåƒš", "å‹é”", "å…ˆè¼©", "å®¶æ—", "å…ˆç”Ÿ(æ•™æˆ)", "ãƒã‚¤ãƒˆå…ˆ"];

      function timePhrase(min, variant) {
        if (!min) return variant === 0 ? "å°‘ã—" : "å°‘ã€…";
        const base = min === "60" ? "ä¸€æ™‚é–“" : `${min}åˆ†`;
        const approx = variant === 0 ? "ã»ã©" : "ãã‚‰ã„";
        return base + approx;
      }

      const TO_STYLE = {
        "": {
          openers: ["ã™ã¿ã¾ã›ã‚“ã€", "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€"],
          closers: [
            "åˆ°ç€ã—æ¬¡ç¬¬ã™ãã«åˆæµã—ã¾ã™ã€‚",
            "é€²å±•ãŒã‚ã‚Œã°ã¾ãŸã”é€£çµ¡ã—ã¾ã™ã€‚",
          ],
        },
        ä¸Šå¸: {
          openers: ["å¤§å¤‰ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€", "ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€"],
          closers: [
            "åˆ°ç€å¾ŒãŸã ã¡ã«åˆæµã—ã€ã™ãã«å¯¾å¿œã„ãŸã—ã¾ã™ã€‚",
            "å¿…è¦ã§ã—ãŸã‚‰å…ˆã«ã”æŒ‡ç¤ºãã ã•ã„ã€‚",
          ],
        },
        åŒåƒš: {
          openers: ["ã™ã¿ã¾ã›ã‚“ã€", "ã”ã‚ã‚“ã€"],
          closers: [
            "å…ˆã«é€²ã‚ã‚‰ã‚Œã‚‹ã¨ã“ã‚ã ã‘ãŠé¡˜ã„ã€‚",
            "åˆ°ç€å¾Œã«å·»ãè¿”ã—ã¾ã™ã€‚",
          ],
        },
        å‹é”: {
          openers: ["ã”ã‚ã‚“ï¼", "ã”ã‚ã‚“ã€"],
          closers: ["å…ˆã«å…¥ã£ã¦ã¦ï¼", "å¾…ãŸã›ã¦ã”ã‚ã‚“ï¼"],
        },
        å…ˆè¼©: {
          openers: ["ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€", "ã™ã¿ã¾ã›ã‚“ã€"],
          closers: [
            "åˆ°ç€ã—æ¬¡ç¬¬ã™ãã«ã”æŒ¨æ‹¶ã«ä¼ºã„ã¾ã™ã€‚",
            "å…ˆã«å§‹ã‚ã¦ã„ãŸã ã‘ã¾ã™ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚",
          ],
        },
        å®¶æ—: {
          openers: ["ã”ã‚ã‚“ã€", "ã”ã‚ã‚“ã­ã€"],
          closers: ["ç€ã„ãŸã‚‰ã™ãé€£çµ¡ã™ã‚‹ã€‚", "å…ˆã«å§‹ã‚ã¦ã¦å¤§ä¸ˆå¤«ã€‚"],
        },
        "å…ˆç”Ÿ(æ•™æˆ)": {
            openers: ["å¤±ç¤¼ã„ãŸã—ã¾ã™ã€", "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€"],
            closers: ["åˆ°ç€ã—æ¬¡ç¬¬ã™ãã«ä¼ºã„ã¾ã™ã€‚", "å…ˆã«å§‹ã‚ã¦ã„ãŸã ã‘ã¾ã™ã¨å¹¸ã„ã§ã™ã€‚"]
        },
        "ãƒã‚¤ãƒˆå…ˆ": {
            openers: ["ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€", "å¤§å¤‰ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€"],
            closers: ["åˆ°ç€æ¬¡ç¬¬ãŸã ã¡ã«æ¥­å‹™ã«å…¥ã‚Šã¾ã™ã€‚", "å¿…è¦ã§ã—ãŸã‚‰å…ˆã«ã”æŒ‡ç¤ºã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚"]
        }
      };

      const CAUSE_TPL = {
        "": ["åˆ°ç€ãŒ{tp}é…ã‚Œã¾ã™ã€‚", "ç¾åœ¨{tp}é…ã‚Œã¦ã„ã¾ã™ã€‚"],
        å¯åŠ: [
          "å¯éã”ã—ã¦ã—ã¾ã„ã€{tp}é…ã‚Œã¾ã™ã€‚",
          "èµ·åºŠãŒé…ã‚Œã¦ãŠã‚Šã€{tp}é…ã‚Œã¾ã™ã€‚",
        ],
        äºˆå®šãŒé•·å¼•ã„ãŸ: [
          "ç›´å‰ã®äºˆå®šãŒé•·å¼•ãã€{tp}é…ã‚Œã¾ã™ã€‚",
          "å‰ã®ç”¨äº‹ãŒæŠ¼ã—ã¦ãŠã‚Šã€{tp}é…ã‚Œã¾ã™ã€‚",
        ],
        é›»è»Šé…å»¶: [
          "é›»è»Šã®é…å»¶ã«ã‚ˆã‚Šã€{tp}é…ã‚Œã¾ã™ã€‚",
          "æœ€å¯„ã‚Šè·¯ç·šãŒé…å»¶ä¸­ã®ãŸã‚ã€{tp}é…ã‚Œã¾ã™ã€‚",
        ],
        ãƒã‚¹é…å»¶: [
          "ãƒã‚¹ã®é…å»¶ã«ã‚ˆã‚Šã€{tp}é…ã‚Œã¾ã™ã€‚",
          "äº¤é€šçŠ¶æ³ã§ãƒã‚¹ãŒé…ã‚Œã¦ãŠã‚Šã€{tp}é…ã‚Œã¾ã™ã€‚",
        ],
        ä½“èª¿ä¸è‰¯: [
          "ä½“èª¿ãŒå„ªã‚Œãšã€{tp}é…ã‚Œã¾ã™ã€‚",
          "æ€¥ã«å…·åˆãŒæ‚ªããªã‚Šã€{tp}é…ã‚Œã¾ã™ã€‚",
        ],
      };

      function buildSentence(min, cause, to, variant) {
        const tp = timePhrase(min, variant);
        const style = TO_STYLE[to] || TO_STYLE[""];
        const opener = style.openers[variant];
        const closer = style.closers[variant];
        const body = (CAUSE_TPL[cause] || CAUSE_TPL[""])[variant].replace(
          "{tp}",
          tp
        );
        return `${opener}${body}${closer}`;
      }

      /* å…¨çµ„åˆã›ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼ˆ7Ã—6Ã—6Ã—2 = 504æ–‡ï¼‰ */
      const PREPARED = {}; // key: "min|cause|to" -> [variant0, variant1]
      for (const min of TIMES) {
        for (const cause of CAUSES) {
          for (const to of TOS) {
            const k = `${min}|${cause}|${to}`;
            PREPARED[k] = [
              buildSentence(min, cause, to, 0),
              buildSentence(min, cause, to, 1),
            ];
          }
        }
      }

      /* ãƒ©ãƒ³ãƒ€ãƒ å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚ã‚Šï¼‰ */
      function getPreparedExcuse(min, cause, to) {
        const k = `${min}|${cause}|${to}`;
        const pool = PREPARED[k] || PREPARED[`${min}||${to}`] || PREPARED[`||`];
        return pool[Math.floor(Math.random() * pool.length)];
      }

        (async function initSlideshow() {
            const slideshowWrapper = document.getElementById("slideshowWrapper");
            const progressDots = document.querySelectorAll(".progress-dot");
            const resultEl = document.getElementById("result");
            const toast = document.getElementById("toast");

            if (!slideshowWrapper || !resultEl) return;

            let currentSlide = 0;
            const state = { min: "", cause: "", to: "" };

            const prevBtn = document.getElementById("prevBtn");
            const nextBtn = document.getElementById("nextBtn");

            function updateArrows() {
                if (currentSlide <= 0) {
                prevBtn.disabled = true;
                prevBtn.classList.add("disabled");
                } else {
                prevBtn.disabled = false;
                prevBtn.classList.remove("disabled");
                }
                if (currentSlide >= 2) {
                nextBtn.disabled = true;
                nextBtn.classList.add("disabled");
                } else {
                nextBtn.disabled = false;
                nextBtn.classList.remove("disabled");
                }
            }

            function goToSlide(slideIndex) {
                currentSlide = Math.max(0, Math.min(2, slideIndex));
                const translateX = -currentSlide * 33.333;
                slideshowWrapper.style.transform = `translateX(${translateX}%)`;

                // Update progress dots
                progressDots.forEach((dot, index) => {
                dot.classList.toggle("active", index === currentSlide);
                });

                updateArrows();
            }

            function nextSlide() {
                if (currentSlide < 2) {
                goToSlide(currentSlide + 1);
                }
            }

            // çŸ¢å°ã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•
            prevBtn.addEventListener("click", () => {
                if (currentSlide > 0) goToSlide(currentSlide - 1);
            });
            nextBtn.addEventListener("click", () => {
                if (currentSlide < 2) goToSlide(currentSlide + 1);
            });

            function selectInGroup(grp, cls) {
                grp.addEventListener("click", (e) => {
                const btn = e.target.closest(".slide-btn");
                if (!btn) return;

                grp
                    .querySelectorAll(".slide-btn")
                    .forEach((b) => b.classList.remove("sel"));
                btn.classList.add("sel");

                if (cls === "min") state.min = btn.dataset.min ?? "";
                if (cls === "cause") state.cause = btn.dataset.cause ?? "";
                if (cls === "to") state.to = btn.dataset.to ?? "";

                render();

                // Auto-advance to next slide after a short delay
                setTimeout(() => {
                    nextSlide();
                }, 100);
                });
            }

            function render() {
                resultEl.textContent = getPreparedExcuse(
                state.min,
                state.cause,
                state.to
                );
            }

            async function copyTextToClipboard(text) {
                if (navigator.clipboard && window.isSecureContext)
                return navigator.clipboard.writeText(text);
                const ta = document.createElement("textarea");
                ta.value = text;
                ta.style.position = "fixed";
                ta.style.left = "-9999px";
                document.body.appendChild(ta);
                ta.focus();
                ta.select();
                try {
                document.execCommand("copy");
                } finally {
                document.body.removeChild(ta);
                }
            }

            resultEl.addEventListener("click", async () => {
                const t = resultEl.textContent.trim();
                if (!t) return;
                await copyTextToClipboard(t);
                if (toast) {
                toast.style.opacity = "1";
                setTimeout(() => (toast.style.opacity = "0"), 900);
                }
            });

            // Progress dot navigation (ã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•)
            progressDots.forEach((dot, index) => {
                dot.addEventListener("click", () => {
                goToSlide(index);
                });
            });

            // Initialize groups and state
            const grpMin = document.getElementById("grp-min");
            const grpCause = document.getElementById("grp-cause");
            const grpTo = document.getElementById("grp-to");

            selectInGroup(grpMin, "min");
            selectInGroup(grpCause, "cause");
            selectInGroup(grpTo, "to");
            render();
            updateArrows(); // åˆæœŸã®çŸ¢å°çŠ¶æ…‹åæ˜ 
        })();


      /* ãƒ‡ãƒãƒƒã‚°ç”¨ã«å…¬é–‹ */
      window.EXCUSE_PREPARED = PREPARED;
      window.getPreparedExcuse = getPreparedExcuse;


    //   ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸæ™‚ã€ä¸€ç•ªä¸Šã§ã¯ãªã100pxã»ã©ä¸‹ã®ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ã€‚iphoneSEã§ã‚‚ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®å‡¦ç½®ã€‚
      (function () {
        const nav = performance.getEntriesByType('navigation')[0];
        const isRestore = nav && (nav.type === 'back_forward'); // æˆ»ã‚‹/é€²ã‚€
        if (location.hash || isRestore) return;

        const header = document.querySelector('.header');
        const offset = 100; // å›ºå®šã§100pxä¸‹ã‹ã‚‰è¡¨ç¤ºã™ã‚‹

        // èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆiOS Safariå¯¾ç­–ã§å°‘ã—é…ã‚‰ã›ã‚‹ï¼‰
        function doScroll() {
            window.scrollTo({ top: offset, left: 0, behavior: 'auto' });
        }
        if (document.readyState === 'complete') {
            setTimeout(doScroll, 50);
        } else {
            window.addEventListener('load', () => setTimeout(doScroll, 50), { once: true });
        }
        })();

    </script>
  </body>
</html>

